pico-8 cartridge // http://www.pico-8.com
version 38
__lua__

function _init()
    color = {}
    color.black = 0
    color.dark_gray = 5
    color.white = 7

    timer = 0
    lastSpawn = 0
    kills = 0

    player = {}
    player.spr = 0
    player.sprDamage = 16
    player.x = 60
    player.y = 60
    player.w = 8
    player.h = 8
    player.speed = .5
    player.health = 3
    player.invincible = 0

    enemies = {}
    projectiles = {}

    music(0)
end

function _draw()
    cls(color.black)

    print(tostr(flr(timer)), 0, 0, color.dark_gray)
    print(tostr(flr(score())), 62, 0, color.white)
    drawHealth()

    if (player.health > 0) then
        foreach(enemies, drawEnemy)
    end
    drawPlayer()
end

function _update60()
    timer += 1/60

    if (player.health <= 0) then
        if (btn(4)) then _init() end
        return
    end

    player.invincible -= 1
    if (player.invincible < 0) then player.invincible = 0 end

    spawnEnemy()

    foreach(enemies, checkCollision)

    updatePlayer()
    foreach(enemies, updateEnemy)
end

function drawPlayer()
    local s = player.spr
    if (flr(player.invincible) % 10 > 0 or player.health <= 0) then
        s = player.sprDamage
    end
    spr(s, player.x, player.y, 1, 1, player.flipX, player.health <= 0)
end

function drawHealth()
    for i = 0,player.health do
        spr(2, 128 - (i * 6), 0, .625, .5)
    end
end

function drawEnemy(enemy)
    spr(enemy.spr, enemy.x, enemy.y, enemy.w / 8, enemy.h / 8)
end

function score()
    return kills + flr(timer / 10)
end

function spawnEnemy()
    local i = flr(rnd(2)) + 3
    local x = flr(rnd(128))
    local y = flr(rnd(128))

    if (timer - lastSpawn > 2) then makeEnemy(i, x, y) end
end

function makeEnemy(spr, x, y)
    local enemy = {}
    enemy.spr = spr
    enemy.x = x
    enemy.y = y
    enemy.w = 5
    enemy.h = 5
    enemy.health = 1
    enemy.speed = .1

    add(enemies, enemy)

    lastSpawn = timer

    return enemy
end

function updatePlayer()
    if (btn(0) and player.x > -4) then
        player.x -= player.speed
        player.flipX = true
    end
    if (btn(1) and player.x < 124) then
        player.x += player.speed
        player.flipX = false
    end
    if (btn(2) and player.y > -4) then player.y -= player.speed end
    if (btn(3) and player.y < 124) then player.y += player.speed end
end

function updateEnemy(enemy)
    if (enemy.x < player.x) then
        enemy.x += enemy.speed
    end
    if (enemy.x > player.x) then
        enemy.x -= enemy.speed
    end
    if (enemy.y < player.y) then
        enemy.y += enemy.speed
    end
    if (enemy.y > player.y) then
        enemy.y -= enemy.speed
    end
end

function checkCollision(enemy)
    if (player.invincible <= 0 and collide(enemy, player)) then
        player.health -=1
        player.invincible = 60
        del(enemies, enemy)
    end
end

function collide(e1, e2)
    return not (e1.x > e2.x + e2.w or
           e1.y > e2.y + e2.h or
           e1.x + e1.w < e2.x or
           e1.y + e1.h < e2.y)
end

__gfx__
044ffff000aaaa0008080000077700000aaa00000110000060000000000000000000000000000000000000000000000000000000000000000000000000000000
44ff1f1f0aa99aa0888e800075757000a999a00011d1000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444fffffaa9aa9aa0888000077777000a9aaa0001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044ffef0aa9aaaaa0080000007570000a999a0000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07778770aa9aaaaa00000000000000000aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f77877faa9aa9aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
066666600aa99aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0550055000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
022eeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22ee1e1e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
222eeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
022ee0e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07778770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e77877e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05500550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
70700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000aaaa00000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000aa99aa0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000aa9aa9aa000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000aa9aaaaa000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000aa9aaaaa000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000aa9aa9aa000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000aa99aa0000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000aaaa00000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000444444400000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000444ffff000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000044fff4f000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000044ffffff00000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000044fff0000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccc0000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000ccccc000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000ccccc000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200200405004050040500405000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000d7500e75010750127500d7500c7500c7500d7500e75013750127501475013750117500e7500b750117500e7500c75009750107500c75008750057500a75006750037500075006750027500075000750
001000000a5000a5000a5000a5000a5000a5000a5000a500075000a5000a5000a5000a5000a5000a5000a5000a5000950009500095000950009500095000950009500095000950009500235201c520295202c520
__music__
02 01020344

